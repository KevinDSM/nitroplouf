<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>NITROPLOUF</title>
    <!-- Importation de la police Roboto depuis Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* Définition des variables CSS pour une personnalisation facile */
        :root {
            --primary-color: #007bff;
            --primary-color-dark: #0056b3;
            --secondary-color: #6c757d;
            --background-color: #f0f2f5;
            --text-color: #333;
            --border-color: #ccc;
            --border-radius: 8px;
            --font-family: 'Roboto', sans-serif;
        }

        /* Styles généraux */
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: var(--text-color);
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 30px;
        }
        /* Styles pour les options */
        .options-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .options-container label {
            font-size: 16px;
            color: var(--text-color);
            cursor: pointer;
        }
        .options-container input[type="checkbox"] {
            margin-right: 5px;
        }
        /* Styles pour le formulaire d'ajout de joueur */
        #addPlayerForm {
            display: none;
            margin: 0 auto 20px auto;
            max-width: 400px;
            background-color: #fff;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #addPlayerForm h3 {
            margin-top: 0;
            text-align: center;
            color: var(--primary-color);
        }
        #addPlayerForm input[type="text"],
        #addPlayerForm input[type="number"],
        #addPlayerForm select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            outline: none;
        }
        #addPlayerForm button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
        }
        #addPlayerForm button:hover {
            background-color: var(--primary-color-dark);
        }
        /* Styles pour la barre de recherche */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 20px auto;
        }
        #playerSearch, #miguelPlayerSearch {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            outline: none;
        }
        #playerSearch:focus, #miguelPlayerSearch:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 5px rgba(0,123,255,0.5);
        }
        #suggestions, #miguelSuggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-top: none;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background-color: #f0f0f0;
        }
        .suggestion-item img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 50%;
            margin-right: 10px;
        }
        .suggestion-item span {
            font-size: 16px;
            color: var(--text-color);
        }
        /* Styles pour les joueurs sélectionnés */
        .selected-players {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        .selected-player {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 10px;
            margin: 10px;
            width: 180px;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .selected-player img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            margin: 0 auto 10px auto;
        }
        .remove-player {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            color: red;
            font-weight: bold;
            font-size: 16px;
        }
        .selected-player div {
            margin-bottom: 5px;
        }
        /* Styles pour les boutons */
        .btn {
            display: block;
            margin: 20px auto;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            width: 200px;
            transition: background-color 0.3s;
            text-align: center;
        }
        .btn:hover {
            background-color: var(--primary-color-dark);
        }
        /* Styles pour le mode Miguel */
        #miguelContainer {
            display: none;
            margin: 0 auto 20px auto;
            max-width: 400px;
            text-align: center;
        }
        #miguelSelectedPlayers {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .miguel-player {
            margin: 5px;
        }
        /* Styles pour le résultat */
        #result {
            margin-top: 30px;
        }
        .group {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .group h3 {
            margin-top: 0;
            text-align: center;
            color: var(--primary-color);
        }
        .group table {
            width: 100%;
            border-collapse: collapse;
        }
        .group th, .group td {
            padding: 10px;
            text-align: left;
        }
        .group th {
            background-color: #f8f9fa;
            border-bottom: 2px solid var(--border-color);
        }
        .group tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        /* Styles pour la section des prochaines fonctionnalités */
        #upcomingFeatures {
            margin-top: 40px;
            padding: 20px;
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #upcomingFeatures h2 {
            margin-top: 0;
            color: var(--primary-color);
            text-align: center;
        }
        #upcomingFeatures ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        /* Style pour le lien de téléchargement */
        #downloadLink {
            position: fixed;
            bottom: 10px;
            right: 10px;
            text-decoration: none;
            color: var(--primary-color);
            font-weight: bold;
        }
        #downloadLink:hover {
            color: var(--primary-color-dark);
        }
        /* Style pour le message de contact */
        #contactMessage {
            margin-top: 20px;
            text-align: center;
            font-size: 16px;
            color: var(--text-color);
        }
    </style>
</head>
<body>

<h1>NITROPLOUF</h1>

<div class="options-container">
    <label><input type="checkbox" id="showRioCheckbox" onchange="toggleShowRio()"> RIO</label>
    <label><input type="checkbox" id="equilibrateCheckbox"> Équilibre</label>
    <label><input type="checkbox" id="addPlayerCheckbox" onchange="toggleAddPlayerForm()"> Ajouter</label>
</div>

<div id="addPlayerForm">
    <h3>Ajouter un joueur</h3>
    <input type="text" id="newPlayerName" placeholder="Nom du joueur">
    <select id="newPlayerRole">
        <option value="" disabled selected>Rôle principal</option>
        <option value="tank">TANK</option>
        <option value="healer">HEAL</option>
        <option value="dps">DPS</option>
    </select>
    <input type="number" id="newPlayerRio" placeholder="Score RIO (optionnel)">
    <button onclick="addNewPlayer()">Ajouter le joueur</button>
</div>

<div class="search-container">
    <input type="text" id="playerSearch" placeholder="Rechercher un joueur..." oninput="suggestPlayers()" autocomplete="off">
    <div id="suggestions"></div>
</div>

<div class="selected-players" id="selectedPlayers"></div>

<button class="btn" onclick="generateGroups()">Lancer le Plouf Plouf</button>

<div id="miguelContainer">
    <h3>Mode Miguel Activé</h3>
    <div class="search-container">
        <input type="text" id="miguelPlayerSearch" placeholder="Sélectionner un joueur..." oninput="suggestMiguelPlayers()" autocomplete="off">
        <div id="miguelSuggestions"></div>
    </div>
    <div id="miguelSelectedPlayers"></div>
    <button class="btn" onclick="validateMiguel()">Valider Miguel</button>
</div>

<div id="result"></div>

<div id="upcomingFeatures">
    <h2>Prochaines fonctionnalités</h2>
    <ul>
        <li>Le mode gif</li>
        <li>Sons personnalisés</li>
        <li>Une section "trend" pour les retardataires qui n'ont jamais les références</li>
        <li>Et bien plus encore</li>
    </ul>
</div>

<div id="contactMessage">
    Contactez Houine pour avoir le lien PayPal pour m'aider dans mon projet (minimum 50 euros)
</div>

<a id="downloadLink" href="https://drive.google.com/file/d/19ko5ZBbUlOZySxhzHeRAH6Hp256wWARt/view" target="_blank">Télécharger Houineaura</a>

<script>
    let guildMembers = [];
    let selectedPlayers = [];
    let showDp = false;
    let miguelMode = false;
    let miguelPlayers = [];

    // Mapping des classes aux couleurs
    const classColors = {
        "Death Knight": "#C41F3B",
        "Demon Hunter": "#A330C9",
        "Druid": "#FF7D0A",
        "Hunter": "#ABD473",
        "Mage": "#69CCF0",
        "Monk": "#00FF96",
        "Paladin": "#F58CBA",
        "Priest": "#FFFFFF",
        "Rogue": "#FFF569",
        "Shaman": "#0070DE",
        "Warlock": "#9482C9",
        "Warrior": "#C79C6E",
        "Evoker": "#33937F",
        "Unknown": "#FFFFFF"
    };

    async function fetchGuildMembers() {
        try {
            const guildName = 'Nitroglycérhum';
            const encodedGuildName = encodeURIComponent(guildName);
            const response = await fetch(`https://raider.io/api/v1/guilds/profile?region=eu&realm=hyjal&name=${encodedGuildName}&fields=members`);
            if (response.ok) {
                const data = await response.json();
                const members = data.members.map(member => member.character);

                // Pour chaque membre, récupérer les données détaillées
                const detailedMembers = await Promise.all(members.map(async (character) => {
                    try {
                        const characterResponse = await fetch(`https://raider.io/api/v1/characters/profile?region=eu&realm=${encodeURIComponent(character.realm)}&name=${encodeURIComponent(character.name)}&fields=mythic_plus_scores_by_season:current,thumbnail_url,class,active_spec_role`);
                        if (characterResponse.ok) {
                            const characterData = await characterResponse.json();
                            const dpScore = characterData.mythic_plus_scores_by_season && characterData.mythic_plus_scores_by_season[0] && characterData.mythic_plus_scores_by_season[0].scores ? characterData.mythic_plus_scores_by_season[0].scores.all || 0 : 0;
                            const classColor = classColors[characterData.class] || "#FFFFFF";

                            return {
                                name: characterData.name,
                                realName: characterData.name,
                                class: characterData.class || 'Unknown',
                                classColor: classColor,
                                role: characterData.active_spec_role ? characterData.active_spec_role.toLowerCase() : 'unknown',
                                dp: Math.round(dpScore),
                                thumbnail_url: characterData.thumbnail_url || 'https://via.placeholder.com/100'
                            };
                        } else {
                            console.error(`Erreur lors de la récupération des données du personnage ${character.name}`);
                            return null;
                        }
                    } catch (error) {
                        console.error(`Erreur réseau lors de la récupération des données du personnage ${character.name}:`, error);
                        return null;
                    }
                }));

                // Filtrer les entrées null (en cas d'erreurs)
                const validMembers = detailedMembers.filter(member => member !== null);

                return validMembers;
            } else {
                console.error('Erreur lors de la récupération des membres de la guilde');
                return [];
            }
        } catch (error) {
            console.error('Erreur réseau lors de la récupération des membres de la guilde:', error);
            return [];
        }
    }

    async function initialize() {
        guildMembers = await fetchGuildMembers();
        // Normaliser les rôles en minuscules
        guildMembers.forEach(member => {
            member.role = (member.role || 'unknown').toLowerCase();
        });

        // Ajouter un écouteur pour la combinaison Maj + = pour le mode Miguel
        document.addEventListener('keydown', (event) => {
            if (event.key === '=' && event.shiftKey && !event.target.matches('input, textarea')) {
                toggleMiguelMode();
            }
        });
    }

    function suggestPlayers() {
        const input = document.getElementById('playerSearch').value.toLowerCase();
        const suggestionsDiv = document.getElementById('suggestions');
        suggestionsDiv.innerHTML = '';

        if (input.length === 0) {
            return;
        }

        const suggestions = guildMembers.filter(member => member.name.toLowerCase().includes(input) && !selectedPlayers.includes(member.name));

        suggestions.forEach(member => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';

            const img = document.createElement('img');
            img.src = member.thumbnail_url || 'https://via.placeholder.com/40';
            div.appendChild(img);

            const nameSpan = document.createElement('span');
            nameSpan.textContent = member.name;
            nameSpan.style.color = member.classColor;
            div.appendChild(nameSpan);

            div.onclick = () => selectPlayer(member.name);
            suggestionsDiv.appendChild(div);
        });
    }

    function selectPlayer(playerName) {
        const player = guildMembers.find(member => member.name === playerName);
        if (player) {
            selectedPlayers.push(player.name);
            displaySelectedPlayers();
            document.getElementById('playerSearch').value = '';
            document.getElementById('suggestions').innerHTML = '';
        }
    }

    function displaySelectedPlayers() {
        const selectedPlayersDiv = document.getElementById('selectedPlayers');
        selectedPlayersDiv.innerHTML = '';

        selectedPlayers.forEach(playerName => {
            const player = guildMembers.find(member => member.name === playerName);

            const div = document.createElement('div');
            div.className = 'selected-player';

            const removeBtn = document.createElement('span');
            removeBtn.className = 'remove-player';
            removeBtn.textContent = '×';
            removeBtn.onclick = () => removePlayer(playerName);
            div.appendChild(removeBtn);

            const img = document.createElement('img');
            img.src = player.thumbnail_url || 'default.jpg';
            div.appendChild(img);

            const nameSpan = document.createElement('div');
            nameSpan.textContent = player.name;
            nameSpan.style.color = player.classColor;
            nameSpan.style.fontWeight = 'bold';
            div.appendChild(nameSpan);

            const roleSpan = document.createElement('div');
            roleSpan.textContent = `Rôle : ${player.role}`;
            div.appendChild(roleSpan);

            if (showDp) {
                const dpSpan = document.createElement('div');
                dpSpan.textContent = `Score RIO : ${player.dp}`;
                div.appendChild(dpSpan);
            }

            selectedPlayersDiv.appendChild(div);
        });
    }

    function removePlayer(playerName) {
        selectedPlayers = selectedPlayers.filter(name => name !== playerName);
        displaySelectedPlayers();
    }

    function generateGroups() {
        if (selectedPlayers.length === 0) {
            alert('Veuillez sélectionner au moins un joueur.');
            return;
        }

        const equilibrate = document.getElementById('equilibrateCheckbox').checked;

        // Récupérer les joueurs sélectionnés avec leurs informations complètes
        const players = selectedPlayers.map(playerName => guildMembers.find(member => member.name === playerName));

        // Compter les rôles
        const tanks = players.filter(p => p.role === 'tank');
        const healers = players.filter(p => p.role === 'healer');
        const dps = players.filter(p => p.role === 'dps');

        // Calculer le nombre de groupes nécessaires
        const maxGroupSize = 5;
        const maxDpsPerGroup = 3;

        const numGroups = Math.max(
            Math.ceil(players.length / maxGroupSize),
            tanks.length,
            healers.length,
            Math.ceil(dps.length / maxDpsPerGroup)
        );

        // Initialiser les groupes
        const groups = [];
        for (let i = 0; i < numGroups; i++) {
            groups.push({
                Tank: null,
                Healer: null,
                DPS: [],
                totalDp: 0,
                members: []
            });
        }

        // Trier les joueurs en fonction du mode Équilibre
        if (equilibrate) {
            // Trier les joueurs par score RIO décroissant
            players.sort((a, b) => b.dp - a.dp);
        } else {
            // Mélanger les joueurs aléatoirement
            players.sort(() => Math.random() - 0.5);
        }

        // Si le mode Miguel est activé, placer les joueurs dans le premier groupe
        if (miguelPlayers.length > 0) {
            const group = groups[0];
            miguelPlayers.forEach(playerName => {
                const player = players.find(p => p.name === playerName);
                if (player) {
                    // Ajouter le joueur au groupe
                    if (player.role === 'tank' && !group.Tank) {
                        group.Tank = player;
                    } else if (player.role === 'healer' && !group.Healer) {
                        group.Healer = player;
                    } else {
                        group.DPS.push(player);
                    }
                    group.members.push(player);
                    group.totalDp += player.dp;
                    // Retirer le joueur de la liste des joueurs à répartir
                    players.splice(players.indexOf(player), 1);
                }
            });
            miguelPlayers = []; // Réinitialiser le mode miguel
            miguelMode = false;
            document.getElementById('miguelContainer').style.display = 'none';
        }

        // Répartir les joueurs restants
        players.forEach(player => {
            let assigned = false;

            // Trouver les groupes possibles pour ce joueur en fonction de son rôle
            let possibleGroups = groups.filter(group => {
                if (player.role === 'tank') {
                    return !group.Tank && group.members.length < maxGroupSize;
                } else if (player.role === 'healer') {
                    return !group.Healer && group.members.length < maxGroupSize;
                } else if (player.role === 'dps') {
                    return group.DPS.length < maxDpsPerGroup && group.members.length < maxGroupSize;
                }
                return group.members.length < maxGroupSize;
            });

            if (possibleGroups.length === 0) {
                // Si aucun groupe ne peut accueillir ce joueur, on l'ajoute au groupe avec le moins de membres
                groups.sort((a, b) => a.members.length - b.members.length);
                possibleGroups = [groups[0]];
            }

            // Si le mode Équilibre est activé, choisir le groupe avec le score total le plus bas
            if (equilibrate) {
                possibleGroups.sort((a, b) => a.totalDp - b.totalDp);
            } else {
                // Sinon, choisir un groupe aléatoirement parmi les groupes possibles
                possibleGroups.sort(() => Math.random() - 0.5);
            }

            const group = possibleGroups[0];

            // Ajouter le joueur au groupe
            if (player.role === 'tank' && !group.Tank) {
                group.Tank = player;
            } else if (player.role === 'healer' && !group.Healer) {
                group.Healer = player;
            } else {
                group.DPS.push(player);
            }
            group.members.push(player);
            group.totalDp += player.dp;
        });

        // Afficher les groupes
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '';

        groups.forEach((group, index) => {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'group';

            const groupTitle = document.createElement('h3');
            groupTitle.textContent = `Groupe ${index + 1}`;
            groupDiv.appendChild(groupTitle);

            const table = document.createElement('table');

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            const thName = document.createElement('th');
            thName.textContent = 'Joueur';
            const thRole = document.createElement('th');
            thRole.textContent = 'Rôle';
            headerRow.appendChild(thName);
            headerRow.appendChild(thRole);
            thead.appendChild(headerRow);
            table.appendChild(thead);
            const tbody = document.createElement('tbody');

            if (group.Tank) {
                const row = document.createElement('tr');
                const cellName = document.createElement('td');
                cellName.textContent = group.Tank.name;
                cellName.style.color = group.Tank.classColor;
                row.appendChild(cellName);

                const cellRole = document.createElement('td');
                cellRole.textContent = 'Tank';
                row.appendChild(cellRole);

                tbody.appendChild(row);
            }

            if (group.Healer) {
                const row = document.createElement('tr');
                const cellName = document.createElement('td');
                cellName.textContent = group.Healer.name;
                cellName.style.color = group.Healer.classColor;
                row.appendChild(cellName);

                const cellRole = document.createElement('td');
                cellRole.textContent = 'Heal';
                row.appendChild(cellRole);

                tbody.appendChild(row);
            }

            group.DPS.forEach(player => {
                const row = document.createElement('tr');
                const cellName = document.createElement('td');
                cellName.textContent = player.name;
                cellName.style.color = player.classColor;
                row.appendChild(cellName);

                const cellRole = document.createElement('td');
                cellRole.textContent = 'DPS';
                row.appendChild(cellRole);

                tbody.appendChild(row);
            });

            table.appendChild(tbody);
            groupDiv.appendChild(table);

            // Affichage du total des scores RIO du groupe si le mode Équilibre est activé
            if (equilibrate) {
                const totalDpDiv = document.createElement('div');
                totalDpDiv.style.marginTop = '10px';
                totalDpDiv.innerHTML = `<strong>Total des scores RIO du groupe :</strong> ${group.totalDp}`;
                groupDiv.appendChild(totalDpDiv);
            }

            resultDiv.appendChild(groupDiv);
        });
    }

    function toggleShowRio() {
        showDp = document.getElementById('showRioCheckbox').checked;
        displaySelectedPlayers();
    }

    function toggleAddPlayerForm() {
        const form = document.getElementById('addPlayerForm');
        form.style.display = document.getElementById('addPlayerCheckbox').checked ? 'block' : 'none';
    }

    function addNewPlayer() {
        const name = document.getElementById('newPlayerName').value.trim();
        const role = document.getElementById('newPlayerRole').value;
        const dp = parseInt(document.getElementById('newPlayerRio').value) || 0;

        if (!name || !role) {
            alert('Veuillez renseigner au moins le nom et le rôle principal du joueur.');
            return;
        }

        // Vérifier si le joueur existe déjà
        if (guildMembers.some(member => member.name === name)) {
            alert('Un joueur avec ce nom existe déjà.');
            return;
        }

        // Ajouter le joueur à la liste des membres
        const newPlayer = {
            name: name,
            realName: name,
            class: 'Unknown',
            classColor: classColors['Unknown'],
            role: role,
            dp: dp,
            thumbnail_url: 'default.jpg'
        };
        guildMembers.push(newPlayer);

        alert(`Joueur ${name} ajouté avec succès.`);

        // Ajouter le joueur à la sélection
        selectedPlayers.push(name);
        displaySelectedPlayers();

        // Réinitialiser le formulaire
        document.getElementById('newPlayerName').value = '';
        document.getElementById('newPlayerRole').value = '';
        document.getElementById('newPlayerRio').value = '';
    }

    function toggleMiguelMode() {
        miguelMode = !miguelMode;
        const miguelContainer = document.getElementById('miguelContainer');
        miguelContainer.style.display = miguelMode ? 'block' : 'none';
        miguelPlayers = [];
        document.getElementById('miguelSelectedPlayers').innerHTML = '';
        document.getElementById('miguelPlayerSearch').value = '';
        document.getElementById('miguelSuggestions').innerHTML = '';
    }

    function suggestMiguelPlayers() {
        const input = document.getElementById('miguelPlayerSearch').value.toLowerCase();
        const suggestionsDiv = document.getElementById('miguelSuggestions');
        suggestionsDiv.innerHTML = '';

        if (input.length === 0 || miguelPlayers.length >= 5) {
            return;
        }

        const suggestions = guildMembers.filter(member => member.name.toLowerCase().includes(input) && !miguelPlayers.includes(member.name));

        suggestions.forEach(member => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';

            const img = document.createElement('img');
            img.src = member.thumbnail_url || 'https://via.placeholder.com/40';
            div.appendChild(img);

            const nameSpan = document.createElement('span');
            nameSpan.textContent = member.name;
            nameSpan.style.color = member.classColor;
            div.appendChild(nameSpan);

            div.onclick = () => selectMiguelPlayer(member.name);
            suggestionsDiv.appendChild(div);
        });
    }

    function selectMiguelPlayer(playerName) {
        if (miguelPlayers.length >= 5) {
            alert('Vous ne pouvez pas ajouter plus de 5 joueurs en mode Miguel.');
            return;
        }
        miguelPlayers.push(playerName);
        displayMiguelPlayers();
        document.getElementById('miguelPlayerSearch').value = '';
        document.getElementById('miguelSuggestions').innerHTML = '';
    }

    function displayMiguelPlayers() {
        const miguelSelectedDiv = document.getElementById('miguelSelectedPlayers');
        miguelSelectedDiv.innerHTML = '';

        miguelPlayers.forEach(playerName => {
            const player = guildMembers.find(member => member.name === playerName);

            const div = document.createElement('div');
            div.className = 'miguel-player';

            const img = document.createElement('img');
            img.src = player.thumbnail_url || 'https://via.placeholder.com/40';
            img.style.width = '40px';
            img.style.height = '40px';
            img.style.borderRadius = '50%';
            div.appendChild(img);

            const nameSpan = document.createElement('div');
            nameSpan.textContent = player.name;
            nameSpan.style.color = player.classColor;
            nameSpan.style.fontSize = '14px';
            nameSpan.style.marginTop = '5px';
            div.appendChild(nameSpan);

            miguelSelectedDiv.appendChild(div);
        });
    }

    function validateMiguel() {
        if (miguelPlayers.length === 0) {
            alert('Veuillez sélectionner au moins un joueur pour le mode Miguel.');
            return;
        }

        // Ajouter les joueurs miguel à la sélection principale s'ils ne le sont pas déjà
        miguelPlayers.forEach(playerName => {
            if (!selectedPlayers.includes(playerName)) {
                selectedPlayers.push(playerName);
            }
        });
        displaySelectedPlayers();
        // Les joueurs seront placés ensemble au prochain tirage
    }

    // Initialiser l'application
    initialize();
</script>

</body>
</html>
